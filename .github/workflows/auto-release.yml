name: ğŸš€ Auto Bump & Release

on:
  push:
    branches:
      - master

jobs:
  bump-and-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write # ì½”ë“œ ìˆ˜ì • ë° ë¦´ë¦¬ì¦ˆ ì‘ì„± ê¶Œí•œ

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ì „ì²´ ì»¤ë°‹ ë¡œê·¸ë¥¼ ê°€ì ¸ì™€ì•¼ ë¶„ì„ ê°€ëŠ¥

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22

      # 1. Git ì‚¬ìš©ì ì„¤ì • (ë´‡ ì´ë¦„ìœ¼ë¡œ ì»¤ë°‹í•˜ê¸° ìœ„í•´)
      - name: Setup Git User
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      # 2. ë²„ì „ ìë™ ê³„ì‚° ë° package.json ì—…ë°ì´íŠ¸
      # 'phips28/gh-action-bump-version' ì•¡ì…˜ì´ ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ë³´ê³  ë²„ì „ì„ ì˜¬ë¦½ë‹ˆë‹¤.
      - name: Bump version in package.json
        id: version_bump
        uses: phips28/gh-action-bump-version@v11.0.3
        with:
          tag-prefix: "v"
          minor-wording: "feat" # ì»¤ë°‹ì— featì´ ìˆìœ¼ë©´ 1.1.0ìœ¼ë¡œ
          major-wording: "major" # ì»¤ë°‹ì— majorê°€ ìˆìœ¼ë©´ 2.0.0ìœ¼ë¡œ
          patch-wording: "fix,chore,refactor,docs" # ë‚˜ë¨¸ì§€ëŠ” 1.0.1ë¡œ
          skip-tag: "true" # íƒœê·¸ëŠ” ì•„ë˜ release ë‹¨ê³„ì—ì„œ ë§Œë“¤ ê±°ë¼ ì—¬ê¸°ì„œ ìŠ¤í‚µ
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 3. ë³€ê²½ëœ package.jsonì„ master ë¸Œëœì¹˜ì— í‘¸ì‹œ
      # (ì•¡ì…˜ì´ ë²„ì „ì„ ê³ ì³¤ìœ¼ë‹ˆ ì €ì¥ì†Œì—ë„ ë°˜ì˜í•´ì¤˜ì•¼ í•¨)
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}

      # 4. ë¦´ë¦¬ì¦ˆ ìƒì„± ë° ë³€ê²½ì‚¬í•­ ìš”ì•½ ê¸€ ì˜¬ë¦¬ê¸°
      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v${{ steps.version_bump.outputs.newTag }} # ìƒˆë¡œ ë§Œë“  ë²„ì „
          name: ğŸš€ Release v${{ steps.version_bump.outputs.newTag }}
          generate_release_notes: true # âœ… ì—¬ê¸°ê°€ í•µì‹¬! GitHubì´ PR ì œëª©ë“¤ì„ ëª¨ì•„ì„œ ìš”ì•½í•´ì¤ë‹ˆë‹¤.
          draft: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
